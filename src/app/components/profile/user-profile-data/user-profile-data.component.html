<div class="profile-container">
  <ng-container *ngIf="userProfile$ | async as userProfile">
    <div class="profile-header">
      <img [src]="userProfile.avatar || 'assets/images/no_profile_avatar.png'" alt="User Avatar" class="avatar">
      <h2>{{ userProfile.username }}</h2>
      <p><strong>–ù—ñ–∫–Ω–µ–π–º:</strong> {{ userProfile.nickname }}</p>
      <p><strong>Email:</strong> {{ userProfile.email }}</p>
      <p><strong>–†–æ–ª—å:</strong> {{ userProfile.role }}</p>
      <p><strong>–û—á–∫–∏ –ø–æ–≤–µ–¥—ñ–Ω–∫–∏:</strong> {{ userProfile.behavior_points }}</p>
      <p><strong>–°—Ç–∞—Ç—å:</strong> {{ userProfile.gender }}</p>
      <p><strong>–î–µ–Ω—å –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è:</strong> {{ userProfile.birthday || '–ù–µ –≤–∫–∞–∑–∞–Ω–æ' }}</p>
      <p><strong>–¢–µ–ª–µ—Ñ–æ–Ω:</strong> {{ userProfile.phone_number || '–ù–µ –≤–∫–∞–∑–∞–Ω–æ' }}</p>
      <p><strong>–ö—Ä–∞—ó–Ω–∞:</strong> {{ userProfile.country || '–ù–µ –≤–∫–∞–∑–∞–Ω–æ' }}</p>
      <p><strong>–ß–∞—Å–æ–≤–∏–π –ø–æ—è—Å:</strong> {{ userProfile.time_zones }}</p>
      <p><strong>–°—Ç–∞—Ç—É—Å:</strong> {{ userProfile.status }}</p>
      <p><strong>–ü–æ—Å–∞–¥–∞:</strong> {{ userProfile.job_title || '–ù–µ –≤–∫–∞–∑–∞–Ω–æ' }}</p>
      <p><strong>–î–≤–æ—Ñ–∞–∫—Ç–æ—Ä–Ω–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è:</strong> {{ userProfile.two_factor_method }}</p>
    </div>

    <hr>

    <!-- üîó –°–æ—Ü—ñ–∞–ª—å–Ω—ñ –º–µ—Ä–µ–∂—ñ -->
    <div class="profile-section">
      <h3>üîó –°–æ—Ü—ñ–∞–ª—å–Ω—ñ –º–µ—Ä–µ–∂—ñ</h3>

      <!-- üîÑ –†–µ–∂–∏–º —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è -->
      <ng-container *ngIf="isEditMode; else viewMode">
        <form [formGroup]="socialsForm">
          <ul>
            <li *ngFor="let key of objectKeys(userProfile.socials ?? {})">
              <strong>{{ key | titlecase }}:</strong>
              <input [formControlName]="key" type="text" [placeholder]="'–í–≤–µ–¥—ñ—Ç—å ' + key">
            </li>
          </ul>
          <button type="button" (click)="saveSocials()" [disabled]="!socialsForm.dirty || socialsForm.invalid">
            üíæ –ó–±–µ—Ä–µ–≥—Ç–∏ –∑–º—ñ–Ω–∏
          </button>
          <button type="button" (click)="cancelEditMode()">
            ‚ùå –°–∫–∞—Å—É–≤–∞—Ç–∏
          </button>
        </form>
      </ng-container>

      <!-- üìÑ –†–µ–∂–∏–º –ø–µ—Ä–µ–≥–ª—è–¥—É -->
      <ng-template #viewMode>
        <ul>
          <li *ngFor="let key of objectKeys(userProfile.socials ?? {})">
            <strong>{{ key | titlecase }}:</strong> {{ userProfile.socials[key] || '–ù–µ –≤–∫–∞–∑–∞–Ω–æ' }}
          </li>
        </ul>
        <button type="button" (click)="enterEditMode()">‚úèÔ∏è –†–µ–¥–∞–≥—É–≤–∞—Ç–∏</button>
      </ng-template>
    </div>

    <hr>

    <div class="profile-section">
      <h3>üèÜ –°–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–∏</h3>
      <ul>
        <li *ngFor="let cert of userProfile.certificates">
          {{ cert || '–ù–µ –≤–∫–∞–∑–∞–Ω–æ' }}
        </li>
      </ul>
    </div>

    <hr>

    <div class="profile-section">
      <h3>üéì –û—Å–≤—ñ—Ç–∞</h3>
      <ul>
        <li *ngFor="let edu of userProfile.education">
          {{ edu || '–ù–µ –≤–∫–∞–∑–∞–Ω–æ' }}
        </li>
      </ul>
    </div>

    <hr>

    <div class="profile-section">
      <h3>üíº –†–æ–±–æ—Ç–∞</h3>
      <ul>
        <li *ngFor="let job of userProfile.jobs">
          <strong>–ö–æ–º–ø–∞–Ω—ñ—è:</strong> {{ job.company?.name || '–ù–µ –≤–∫–∞–∑–∞–Ω–æ' }}<br>
          <strong>–ü–æ—Å–∞–¥–∞:</strong> {{ job.position || '–ù–µ –≤–∫–∞–∑–∞–Ω–æ' }}<br>
          <strong>–ü–æ—á–∞—Ç–æ–∫:</strong> {{ job.started_at || '–ù–µ –≤–∫–∞–∑–∞–Ω–æ' }}<br>
          <strong>–ö—ñ–Ω–µ—Ü—å:</strong> {{ job.ended_at || '–ù–µ –≤–∫–∞–∑–∞–Ω–æ' }}<br>
          <strong>–û–ø–∏—Å:</strong> {{ job.description || '–ù–µ –≤–∫–∞–∑–∞–Ω–æ' }}
        </li>
      </ul>
    </div>

    <hr>

    <div class="profile-section">
      <h3>üí° –¢–µ—Ö–Ω–æ–ª–æ–≥—ñ—ó</h3>
      <ul>
        <li *ngFor="let tech of userProfile.technologies">
          {{ tech.name }}
        </li>
      </ul>
    </div>

    <hr>

    <div class="profile-section">
      <h3>üë• –î—Ä—É–∑—ñ</h3>
      <ul>
        <li *ngFor="let friend of userProfile.friends">
          <img [src]="friend.avatar" alt="Friend Avatar" class="friend-avatar">
          {{ friend.nickname }}
        </li>
      </ul>
    </div>

    <hr>

    <div class="profile-section">
      <h3>üöÄ –ü—Ä–æ—î–∫—Ç–∏</h3>
      <ul>
        <li *ngFor="let project of userProfile.projects">
          <strong>–ù–∞–∑–≤–∞:</strong> {{ project.name }}<br>
          <strong>–û–ø–∏—Å:</strong> {{ project.description || '–ù–µ –≤–∫–∞–∑–∞–Ω–æ' }}<br>
          <strong>–ö—Ä–µ–∞—Ç–æ—Ä:</strong> {{ project.creator.nickname }}
        </li>
      </ul>
    </div>

    <hr>

    <div class="profile-section">
      <h3>üé≠ –†–µ–∞–∫—Ü—ñ—ó</h3>
      <ul>
        <li *ngFor="let reaction of userProfile.reactions">
          {{ reaction }}
        </li>
      </ul>
    </div>
  </ng-container>

  <hr>

  <div class="blacklist-section">
    <h3 class="section-title">üö´ –ß–æ—Ä–Ω–∏–π —Å–ø–∏—Å–æ–∫</h3>

    <ng-container *ngIf="blackListUsers.length > 0; else noUsers">
      <div class="blacklist-container">
        <div *ngFor="let user of blackListUsers" class="blacklist-user">
          <img src="assets/images/no_profile_avatar.png" class="user-avatar" alt="User Avatar" />
          <div class="user-details">
            <span class="nickname">{{ user.blocked_user.nickname }}</span>
            <span class="username">{{ user.blocked_user.username }}</span>
          </div>
          <button class="unblock-button" (click)="unblockUser(user.blocked_user.id)">üöÄ –†–æ–∑–±–ª–æ–∫—É–≤–∞—Ç–∏</button>
        </div>
      </div>
    </ng-container>

    <ng-template #noUsers>
      <div class="no-blacklist-message">
        <p>üïäÔ∏è –£ –≤–∞—à–æ–º—É —á–æ—Ä–Ω–æ–º—É —Å–ø–∏—Å–∫—É –ø–æ–∫–∏ –Ω–µ–º–∞—î –∑–∞–±–ª–æ–∫–æ–≤–∞–Ω–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤.</p>
      </div>
    </ng-template>
  </div>

  <hr>

  <form [formGroup]="newPasswordForm" class="security-form">
    <h3 class="section-title">üîë –ó–º—ñ–Ω–∏—Ç–∏ –ø–∞—Ä–æ–ª—å</h3>

    <div class="form-group">
      <label>–°—Ç–∞—Ä–∏–π –ø–∞—Ä–æ–ª—å</label>
      <input formControlName="current_password" type="password" class="form-control" placeholder="–í–≤–µ–¥—ñ—Ç—å —Å—Ç–∞—Ä–∏–π –ø–∞—Ä–æ–ª—å" (input)="changePasswordServerError = null"/>
    </div>

    <div class="form-group">
      <label>–ù–æ–≤–∏–π –ø–∞—Ä–æ–ª—å</label>
      <input formControlName="new_password" type="password" class="form-control" placeholder="–í–≤–µ–¥—ñ—Ç—å –Ω–æ–≤–∏–π –ø–∞—Ä–æ–ª—å"/>

      <p class="error-text" *ngIf="newPasswordForm.get('new_password')?.hasError('required') && newPasswordForm.get('new_password')?.touched">
        –ü–æ–ª–µ –Ω–µ –º–æ–∂–µ –±—É—Ç–∏ –ø—É—Å—Ç–∏–º
      </p>
      <p class="error-text" *ngIf="newPasswordForm.get('new_password')?.hasError('pattern') && newPasswordForm.get('new_password')?.touched">
        –ü–∞—Ä–æ–ª—å –º–∞—î –º—ñ—Å—Ç–∏—Ç–∏ –º—ñ–Ω—ñ–º—É–º 8 —Å–∏–º–≤–æ–ª—ñ–≤, –æ–¥–Ω—É —Ü–∏—Ñ—Ä—É —ñ –æ–¥–∏–Ω —Å–ø–µ—Ü—ñ–∞–ª—å–Ω–∏–π —Å–∏–º–≤–æ–ª
      </p>
    </div>

    <div class="form-group">
      <label>–ü–æ–≤—Ç–æ—Ä—ñ—Ç—å –Ω–æ–≤–∏–π –ø–∞—Ä–æ–ª—å</label>
      <input formControlName="confirm_password" type="password" class="form-control" placeholder="–ü–æ–≤—Ç–æ—Ä—ñ—Ç—å –Ω–æ–≤–∏–π –ø–∞—Ä–æ–ª—å"/>

      <p class="error-text" *ngIf="newPasswordForm.hasError('passwordMismatch') && newPasswordForm.get('confirm_password')?.touched">
        –ü–∞—Ä–æ–ª—ñ –Ω–µ —Å–ø—ñ–≤–ø–∞–¥–∞—é—Ç—å!
      </p>
    </div>

    <p class="server-error" *ngIf="changePasswordServerError">{{ changePasswordServerError }}</p>

    <button type="button" class="btn btn-primary change-password-btn" (click)="changeProfilePassword()" [disabled]="newPasswordForm.invalid">
      üîÑ –û–Ω–æ–≤–∏—Ç–∏ –ø–∞—Ä–æ–ª—å
    </button>
  </form>
</div>
